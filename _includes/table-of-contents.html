{% comment %}
  Generate a table of contents from the page content
  Usage: {% include table-of-contents.html %}
{% endcomment %}

<div class="toc-container">
  <div class="toc-title">Table of Contents</div>
  <ul class="toc-list" id="toc-list">
    <!-- ToC will be generated by JavaScript -->
  </ul>
</div>

<script>
// Generate Table of Contents from page headings
function generateTOC() {
  const tocList = document.getElementById('toc-list');
  const headings = document.querySelectorAll('.article-content h2, .article-content h3, .article-content h4, .article-content h5, .article-content h6');
  
  if (headings.length === 0) {
    tocList.innerHTML = '<li><p style="color: var(--text-muted); font-style: italic;">No headings found on this page.</p></li>';
    return;
  }
  
  let tocHTML = '';
  
  headings.forEach((heading, index) => {
    const level = parseInt(heading.tagName.charAt(1));
    const text = heading.textContent.trim();
    
    // Generate ID if not present
    if (!heading.id) {
      heading.id = text.toLowerCase()
        .replace(/[^\w\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-');
    }
    
    const indentClass = `toc-h${level}`;
    
    tocHTML += `
      <li class="${indentClass}">
        <a href="#${heading.id}" onclick="scrollToHeading('${heading.id}')">${text}</a>
      </li>
    `;
  });
  
  tocList.innerHTML = tocHTML;
}

function scrollToHeading(id) {
  const element = document.getElementById(id);
  if (element) {
    element.scrollIntoView({ 
      behavior: 'smooth',
      block: 'start'
    });
  }
}

// Highlight current section based on scroll position
function updateTocHighlight() {
  const headings = document.querySelectorAll('.article-content h2, .article-content h3, .article-content h4, .article-content h5, .article-content h6');
  const tocLinks = document.querySelectorAll('.toc-list a');
  
  if (headings.length === 0) return;
  
  let currentHeading = null;
  
  // Find the current heading based on scroll position
  headings.forEach((heading) => {
    const rect = heading.getBoundingClientRect();
    if (rect.top <= 100) { // 100px offset for sticky header
      currentHeading = heading;
    }
  });
  
  // Update ToC highlighting
  tocLinks.forEach(link => {
    link.classList.remove('active');
    if (currentHeading && link.getAttribute('href') === '#' + currentHeading.id) {
      link.classList.add('active');
    }
  });
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  generateTOC();
  window.addEventListener('scroll', updateTocHighlight);
  updateTocHighlight(); // Initial call
});
</script>
