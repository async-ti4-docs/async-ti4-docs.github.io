---
layout: default
title: "Search Results"
permalink: /search/
---

<!-- Include search data -->
{% include search-data.html %}

<div class="search-page">
    <div class="container">
        <header class="search-header">
            <h1 class="search-title">Search Docs</h1>
            <div class="search-input-container">
                <input type="text" id="search-page-input" class="search-page-input" placeholder="Search docs..." autofocus>
                <button type="button" class="search-button" id="search-button">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </header>
        
        <main class="search-content">
            <div id="search-status" class="search-status"></div>
            <div id="search-page-results" class="search-page-results"></div>
        </main>
    </div>
</div>

<script>
// Search page functionality
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-page-input');
    const searchButton = document.getElementById('search-button');
    const searchResults = document.getElementById('search-page-results');
    const searchStatus = document.getElementById('search-status');
    
    // Get query from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const initialQuery = urlParams.get('q') || '';
    
    if (initialQuery) {
        searchInput.value = initialQuery;
        performSearchPageSearch(initialQuery);
    }
    
    // Search functionality
    function performSearchPageSearch(query) {
        if (!query || !query.trim()) {
            searchResults.innerHTML = '';
            searchStatus.innerHTML = '';
            return;
        }
        
        searchStatus.innerHTML = '<div class="search-loading">Searching...</div>';
        
        // Wait for search data to be available
        setTimeout(function() {
            if (!window.searchData) {
                searchStatus.innerHTML = '<div class="search-error">Search data not available. Please try again.</div>';
                return;
            }
            
            const results = window.searchData.filter(item => {
                if (!item || typeof item !== 'object') return false;
                
                const title = item.title || '';
                const content = item.content || '';
                const tags = item.tags || '';
                const searchText = `${title} ${content} ${tags}`.toLowerCase();
                
                return searchText.includes(query.toLowerCase());
            });
            
            displaySearchPageResults(results, query);
        }, 100);
    }
    
    // Display search results
    function displaySearchPageResults(results, query) {
        if (results.length === 0) {
            searchStatus.innerHTML = `<div class="search-no-results">No results found for "${query}"</div>`;
            searchResults.innerHTML = '';
            return;
        }
        
        searchStatus.innerHTML = `<div class="search-count">${results.length} result${results.length === 1 ? '' : 's'} found for "${query}"</div>`;
        
        const resultsHTML = results.map(item => {
            const excerpt = getSearchExcerpt(item.content, query);
            const highlightedTitle = highlightText(item.title, query);
            const highlightedExcerpt = highlightText(excerpt, query);
            
            return `
                <article class="search-result-card">
                    <header class="search-result-header">
                        <h2 class="search-result-title">
                            <a href="${item.url}">${highlightedTitle}</a>
                        </h2>
                        <div class="search-result-url">${item.url}</div>
                    </header>
                    <div class="search-result-content">
                        <p class="search-result-excerpt">${highlightedExcerpt}</p>
                    </div>
                </article>
            `;
        }).join('');
        
        searchResults.innerHTML = resultsHTML;
    }
    
    // Get excerpt with context around query
    function getSearchExcerpt(content, query) {
        if (!content || typeof content !== 'string') return '';
        if (!query || typeof query !== 'string') return content.substring(0, 200);
        
        const maxLength = 200;
        const queryLower = query.toLowerCase();
        const contentLower = content.toLowerCase();
        const queryIndex = contentLower.indexOf(queryLower);
        
        if (queryIndex === -1) {
            return content.substring(0, maxLength) + (content.length > maxLength ? '...' : '');
        }
        
        const start = Math.max(0, queryIndex - 50);
        const end = Math.min(content.length, queryIndex + query.length + 100);
        let excerpt = content.substring(start, end);
        
        if (start > 0) excerpt = '...' + excerpt;
        if (end < content.length) excerpt = excerpt + '...';
        
        return excerpt;
    }
    
    // Highlight query text in content
    function highlightText(text, query) {
        if (!text || !query) return text;
        
        const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
        return text.replace(regex, '<mark class="search-highlight">$1</mark>');
    }
    
    // Event listeners
    searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            const query = this.value.trim();
            if (query) {
                // Update URL
                const newUrl = new URL(window.location);
                newUrl.searchParams.set('q', query);
                window.history.replaceState({}, '', newUrl);
                
                performSearchPageSearch(query);
            }
        }
    });
    
    searchButton.addEventListener('click', function() {
        const query = searchInput.value.trim();
        if (query) {
            // Update URL
            const newUrl = new URL(window.location);
            newUrl.searchParams.set('q', query);
            window.history.replaceState({}, '', newUrl);
            
            performSearchPageSearch(query);
        }
    });
});
</script>
